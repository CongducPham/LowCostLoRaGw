The `lora_gateway/gps` folder is necessary to store GPS related files generated by `CloudGpsFile.py`.

`CloudGpsFile.py` is a dedicated post-processing module that will search in incoming messages a valid `LAT` and `LGT` field such as in `BC/9/LAT/43.31402/LGT/-0.36370/FXT/4180`.

You can enable `CloudGpsFile.py` in `clouds.json`. When a message with valid GPS coordinates is received, `CloudGpsFile.py` will add/update an entry in `gps/gps.json` file containing relevant packet and GPS information, including the distance (in km) between the gateway and the GPS device:

	{
		"devices": [
			{
				"gw": "00000027EB5A71F7", 
				"src": "30", 
				"name": "waziup_UPPA_Sensor30", 
				"seq": 134, 
				"bc": 1, 
				"fxt": 4180, 
				"lat": 43.31487, 
				"snr": 7, 
				"time": "2018-08-05T11:08:52", 
				"active": "no", 
				"rssi": -59, 
				"lgt": -0.36721, 
				"distance": 0.2822
			},
			...
	    ]
	}			

In the distribution, we provide an example file containing 7 devices. You can use the following gateway coordinates to run the GPS web interface with the provided example `gps.json` file: 

	...
	"ref_latitude" : "43.314106",
	"ref_longitude" : "-0.363887",
	...

![](https://github.com/CongducPham/LowCostLoRaGw/blob/master/images/gps-web-interface.png)

`CloudGpsFile.py` also extract from the list of GPS devices those that have sent GPS information during the last time window.
`key_GpsFile.py` defines `active_interval_minutes` to 20 minutes. For instance, devices that have sent GPS info in the last 20 minutes will be indicated as active. Those active devices are further maintained in `gps/active_gps.json`.

You can test `CloudGpsFile.py` in standalone mode with:

	> python CloudGpsFile.py "BC/1/LAT/43.31532/LGT/-0.36705/FXT/4180" "1,16,36,0,9,8,-45" "125,5,12" "2018-08-05T11:08:52" "00000027EB5A71F7"
	
`update_gps_json.sh` script is useful to update the time field of devices in `gps.json` file to visualize the devices with the GPS web interface. By default, the time window is set to 20 minutes from the current time on the gateway. You can run `update_gps_json.sh` without any parameter to replace with current gateway time, or you can provide a specific time as follows:

	./update_gps_json.sh 2018-08-05T06:04:24
	
Here, `update_gps_json.sh` will replace for all devices the time field with "2018-08-05T06:04:24" and will display the time difference between the gateway's current time and the specified time. Note that the time difference is only valid within the same day.	

To test with the provided example `gps.json` file, run `update_gps_json.sh` without any parameter to replace with current gateway time so that all devices will be determined as active for the GPS web interface.

More information on GPS and `CloudGpsFile.py` can be found in the [Low-cost-LoRa-Collar](https://github.com/CongducPham/tutorials/blob/master/Low-cost-LoRa-Collar.pdf) tutorial.